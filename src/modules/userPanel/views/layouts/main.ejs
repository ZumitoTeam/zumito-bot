<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de <%= botName %></title>
    <link rel="icon" type="image/png" href="/admin/assets/favicon.png">
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        discord: {
                            primary: '#5865F2',
                            green: '#57F287',
                            yellow: '#FEE75C',
                            fuchsia: '#EB459E',
                            red: '#ED4245',
                            white: '#FFFFFF',
                            dark: {
                                100: '#424549',
                                200: '#36393f',
                                300: '#282b30',
                                400: '#1e2124'
                            }
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    screens: {
                        'xs': '480px',
                        'sm': '640px',
                        'md': '768px',
                        'lg': '1024px',
                        'xl': '1280px',
                        '2xl': '1536px',
                    }
                }
            }
        }
    </script>
    <!-- Custom Styles -->
    <style type="text/tailwind">
        @layer components {
            .btn-primary {
                @apply px-4 py-2 bg-discord-primary text-white rounded hover:bg-discord-primary/90 transition-colors focus:outline-none focus:ring-2 focus:ring-discord-primary/50 focus:ring-offset-2 focus:ring-offset-discord-dark-300;
            }
            .btn-secondary {
                @apply px-4 py-2 bg-discord-dark-100 text-white rounded hover:bg-discord-dark-100/90 transition-colors focus:outline-none focus:ring-2 focus:ring-discord-dark-100/50;
            }
            .btn-danger {
                @apply px-4 py-2 bg-discord-red text-white rounded hover:bg-discord-red/90 transition-colors focus:outline-none focus:ring-2 focus:ring-discord-red/50;
            }
            .card {
                @apply p-6 bg-discord-dark-200 rounded-lg shadow-lg text-white border border-discord-dark-100/30;
            }
            .input {
                @apply px-3 py-2 bg-discord-dark-400 border border-discord-dark-100 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-discord-primary/50;
            }
            .scrollbar {
                @apply scrollbar-thin scrollbar-thumb-discord-dark-100 scrollbar-track-discord-dark-300;
            }
        }
    </style>
    <!-- Alpine.js CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Scrollbar Styles -->
    <style>
        /* Estilo personalizado para scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e2124;
        }
        ::-webkit-scrollbar-thumb {
            background: #424549;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #5865F2;
        }
        
        /* Estilos para Alpine.js */
        [x-cloak] {
            display: none !important;
        }
    </style>
</head>
<body class="bg-discord-dark-300 min-h-screen text-white overflow-x-hidden">
    <!-- Navbar -->
    <nav class="bg-discord-dark-400 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-semibold text-discord-primary flex items-center gap-2">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M9.5 14.25C9.5 15.2165 8.7165 16 7.75 16C6.7835 16 6 15.2165 6 14.25C6 13.2835 6.7835 12.5 7.75 12.5C8.7165 12.5 9.5 13.2835 9.5 14.25Z"></path>
                            <path d="M18 14.25C18 15.2165 17.2165 16 16.25 16C15.2835 16 14.5 15.2165 14.5 14.25C14.5 13.2835 15.2835 12.5 16.25 12.5C17.2165 12.5 18 13.2835 18 14.25Z"></path>
                            <path fill-rule="evenodd" clip-rule="evenodd" d="M20.0001 4C20.0001 4 17.6107 2.27076 15.0001 2L14.7744 2.45651C17.1826 3.09549 18.2738 3.98415 19.0001 5C17.2108 4.03897 15.4282 3 12.0001 3C8.57606 3 6.78942 4.03898 5.00006 5C5.72635 3.98415 6.94923 3.04774 9.22583 2.45651L9.00006 2C6.32123 2.27076 4.00006 4 4.00006 4C4.00006 4 1.30223 8.25133 1.00006 15.5C3.23341 18.3147 7.00006 18 7.00006 18L7.7662 17.0091C6.29666 16.5176 4.64902 15.698 3.00006 14C4.61479 15.1095 6.95833 16.5 12.0001 16.5C17.042 16.5 19.3855 15.1095 21.0001 14C19.3512 15.698 17.7036 16.5176 16.234 17.0091L17.0001 18C17.0001 18 20.7667 18.3147 23.0001 15.5C22.6979 8.25133 20.0001 4 20.0001 4Z"></path>
                        </svg>
                        <%= botName %> Panel
                    </span>
                </div>
                <div class="flex items-center space-x-4">
                    <% if (tokenData) { %>
                        <div class="flex items-center gap-3 bg-discord-dark-300 px-3 py-1.5 rounded-md hidden md:flex">
                            <div class="w-8 h-8 rounded-full bg-discord-primary flex items-center justify-center">
                                <%= tokenData.discordUserData.username.charAt(0).toUpperCase() %>
                            </div>
                            <span class="text-discord-white font-medium"><%= tokenData.discordUserData.username %></span>
                            <a href="/admin/logout" class="text-discord-white/70 hover:text-discord-red transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                </svg>
                            </a>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </nav>

    <!-- Content -->
    <div class="flex flex-col md:flex-row">
        <!-- Mobile Navigation Toggle (visible solo en móvil) -->
        <div class="fixed bottom-0 left-0 right-0 bg-discord-dark-400 z-50 flex justify-around py-2 md:hidden">
            <button id="toggleServerBar" class="text-discord-white/70 p-2 rounded-full hover:bg-discord-dark-300">
                <!-- Icono puzzle/plugin -->
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a1 1 0 01-1-1V9a1 1 0 011-1h1a2 2 0 100-4H4a1 1 0 01-1-1V5a1 1 0 011-1h3a1 1 0 001-1V4z" />
                </svg>
            </button>
            <button id="toggleSidebar" class="text-discord-white/70 p-2 rounded-full hover:bg-discord-dark-300">
                <!-- Icono config -->
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
        </div>

        <% if (!hideSidebar) { %>
        <!-- Server Bar (estilo Discord) - En desktop como sidebar, en móvil como bottomsheet -->
        <aside id="serverBar" class="bg-discord-dark-400 fixed transition-all duration-300 z-40
            md:w-[72px] md:h-screen md:left-0 md:top-16 md:flex md:flex-col md:items-center md:pt-3 md:gap-2 md:overflow-y-auto md:pb-20 
            w-full h-[70vh] left-0 bottom-0 transform translate-y-full md:translate-y-0 rounded-t-xl md:rounded-none overflow-hidden shadow-lg">
            
            <!-- Header del bottomsheet (solo visible en móvil) -->
            <div class="flex items-center justify-between p-3 border-b border-discord-dark-300 md:hidden">
                <span class="text-discord-white font-medium">Modulos</span>
                <button id="closeServerBar" class="text-discord-white/60 hover:text-discord-white">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Contenido en grid para móvil (separado de desktop) -->
            <div class="grid grid-cols-4 gap-3 p-4 overflow-y-auto h-full md:hidden">
                <% for (const item of navItems) { %>
                    <a href="<%= item.url %>" class="flex flex-col items-center justify-center gap-1">
                        <div class="w-14 h-14 bg-discord-dark-200 rounded-[16px] flex items-center justify-center shadow-md<% if (selectedNavItem && item.url === selectedNavItem.url) { %> bg-discord-primary<% } %>">
                            <% if (item.icon) { %>
                                <div class="w-7 h-7 text-discord-white/80<% if (selectedNavItem && item.url === selectedNavItem.url) { %> text-white<% } %>">
                                    <%- item.icon %>
                                </div>
                            <% } else { %>
                                <svg class="w-7 h-7 text-discord-white/80<% if (selectedNavItem && item.url === selectedNavItem.url) { %> text-white<% } %>" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                </svg>
                            <% } %>
                        </div>
                        <span class="text-xs text-discord-white/80 truncate text-center"><%= item.label %></span>
                    </a>
                <% } %>
            </div>
            
            <!-- Elementos para desktop con margen entre botones -->
            <div class="hidden md:flex md:flex-col md:gap-4 md:items-center">
                <% for (const item of navItems) { %>
                    <div class="relative group">
                        <a href="<%= item.url %>"
                           class="w-12 h-12 bg-discord-dark-200 rounded-[24px] hover:rounded-[16px] hover:bg-discord-primary transition-all duration-200 flex items-center justify-center group relative<% if (selectedNavItem && item.url === selectedNavItem.url) { %> bg-discord-primary rounded-[16px]<% } %>">
                            <% if (item.icon) { %>
                                <div class="w-6 h-6 text-discord-white/60 group-hover:text-white<% if (selectedNavItem && item.url === selectedNavItem.url) { %> text-white<% } %>">
                                    <%- item.icon %>
                                </div>
                            <% } else { %>
                                <svg class="w-6 h-6 text-discord-white/60 group-hover:text-white<% if (selectedNavItem && item.url === selectedNavItem.url) { %> text-white<% } %>" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                                </svg>
                            <% } %>
                            <% if (selectedNavItem && item.url === selectedNavItem.url) { %>
                                <div class="absolute left-[-8px] w-2 h-8 bg-white rounded-r-full"></div>
                            <% } %>
                        </a>
                    </div>
                <% } %>
            </div>
            
        </aside>

        <!-- Channel List (como Discord) -->
        <aside id="channelList" class="w-60 bg-discord-dark-300 h-screen fixed left-0 md:left-[72px] pt-3 overflow-y-auto pb-20 transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-40">
            <div class="px-3">
                <div class="flex items-center justify-between p-2 bg-discord-dark-400 rounded-lg hover:bg-discord-dark-200 cursor-pointer transition-colors">
                    <span class="font-medium text-discord-white truncate"><%= selectedNavItem?.label || 'Panel de Control' %></span>
                    <svg class="w-4 h-4 flex-shrink-0 text-discord-white/60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </div>
                
                <!-- Categorías -->
                <% if (selectedNavItem && selectedNavItem.sidebar && selectedNavItem.sidebar.sections) { %>
                    <% for (const section of selectedNavItem.sidebar.sections) { %>
                        <div class="mt-6">
                            <div class="text-discord-white/40 uppercase text-xs font-semibold px-2 flex items-center justify-between">
                                <span><%= section.label %></span>
                                <% if (section.collapsible) { %>
                                    <svg class="w-3 h-3 cursor-pointer hover:text-discord-white/60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                                    </svg>
                                <% } %>
                            </div>
                            <div class="mt-2 space-y-1">
                                <% for (const item of section.items) { %>
                                    <a href="<%= item.url %>" class="flex items-center px-2 py-1.5 rounded text-discord-white/60 hover:text-discord-white hover:bg-discord-dark-200 transition-colors<% if (reqPath === item.url) { %> bg-discord-dark-200 text-white<% } %>">
                                        <span class="mr-1.5">#</span>
                                        <span class="truncate"><%= item.label %></span>
                                        <% if (item.badge) { %>
                                            <span class="ml-auto bg-discord-primary text-xs px-1.5 py-0.5 rounded-full font-medium"><%= item.badge %></span>
                                        <% } %>
                                    </a>
                                <% } %>
                            </div>
                        </div>
                    <% } %>
                <% } else { %>
                    <div class="mt-6 text-discord-white/40 text-xs px-2">Ninguna sección disponible</div>
                <% } %>

            </div>
        </aside>
        <% } %>

        <!-- Main content -->
        <main class="<% if (!hideSidebar) { %>w-full md:ml-[calc(72px+240px)]<% } %> px-4 md:px-8 py-6 flex-1 pb-20 bg-discord-dark-200 min-h-[calc(100vh-64px)]">
            <% if (typeof pageTitle !== 'undefined') { %>
                <h1 class="text-xl md:text-2xl font-bold mb-6 text-discord-white border-b border-discord-dark-100/30 pb-3"><%= pageTitle %></h1>
            <% } %>
            <%- content %>
        </main>
    </div>

    <!-- Footer -->
    <footer class="fixed bottom-0 right-0 <% if (!hideSidebar) { %>md:left-[calc(72px+240px)]<% } else { %>left-0<% } %> bg-discord-dark-400 shadow-lg z-10 w-full md:w-auto hidden md:block">
        <div class="px-4 py-3 text-center text-discord-white/40 text-sm flex items-center justify-between">
            <span><%= botName %> Panel &copy; <%= new Date().getFullYear() %></span>
            <span class="text-discord-primary/70">v<%= typeof version !== 'undefined' ? version : '1.0.0' %></span>
        </div>
    </footer>

    <!-- JavaScript para la interactividad -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toggleSidebarButton = document.getElementById('toggleSidebar');
            const toggleServerBarButton = document.getElementById('toggleServerBar');
            const closeSidebarButton = document.getElementById('closeSidebar');
            const channelList = document.getElementById('channelList');
            const serverBar = document.getElementById('serverBar');
            
            // Función para cerrar todos los menús móviles
            function closeAllMenus() {
                if (channelList) {
                    channelList.classList.remove('translate-x-0');
                    channelList.classList.add('-translate-x-full');
                }
                if (serverBar && window.innerWidth < 768) {
                    // Solo cerramos en móvil, en desktop siempre visible
                    serverBar.classList.remove('translate-y-0');
                    serverBar.classList.add('translate-y-full');
                    removeOverlay();
                }
            }
            
            // Toggle para el menú de canales
            if (toggleSidebarButton && channelList) {
                toggleSidebarButton.addEventListener('click', function() {
                    // Cerrar server bar si está abierto (tanto en escritorio como en móvil)
                    if (serverBar) {
                        if (window.innerWidth < 768) {
                            // En móvil usamos translate-y
                            if (serverBar.classList.contains('translate-y-0')) {
                                serverBar.classList.remove('translate-y-0');
                                serverBar.classList.add('translate-y-full');
                                removeOverlay();
                            }
                        } else {
                            // En desktop usamos translate-x
                            if (serverBar.classList.contains('translate-x-0')) {
                                serverBar.classList.remove('translate-x-0');
                                serverBar.classList.add('-translate-x-full');
                            }
                        }
                    }
                    
                    // Toggle del channel list
                    if (channelList.classList.contains('-translate-x-full')) {
                        channelList.classList.remove('-translate-x-full');
                        channelList.classList.add('translate-x-0');
                        // Añadir overlay sólo en móvil
                        if (window.innerWidth < 768) {
                            addOverlay('sidebar-overlay');
                        }
                    } else {
                        channelList.classList.remove('translate-x-0');
                        channelList.classList.add('-translate-x-full');
                        // Quitar overlay
                        removeOverlay();
                    }
                });
            }
            
            // Toggle para la barra de servidores
            if (toggleServerBarButton && serverBar) {
                toggleServerBarButton.addEventListener('click', function() {
                    // Cerrar channel list si está abierto
                    if (channelList && channelList.classList.contains('translate-x-0')) {
                        channelList.classList.remove('translate-x-0');
                        channelList.classList.add('-translate-x-full');
                        removeOverlay(); // Quitar el overlay del sidebar si está abierto
                    }
                    
                    // Toggle del server bar (como bottomsheet en móvil)
                    if (window.innerWidth < 768) {
                        // En móvil usamos translate-y
                        if (serverBar.classList.contains('translate-y-full')) {
                            serverBar.classList.remove('translate-y-full');
                            serverBar.classList.add('translate-y-0');
                            // Añadir overlay
                            addOverlay('serverbar-overlay');
                        } else {
                            serverBar.classList.remove('translate-y-0');
                            serverBar.classList.add('translate-y-full');
                            // Quitar overlay
                            removeOverlay();
                        }
                    }
                    // Eliminamos el toggle en desktop ya que siempre debe estar visible
                });
            }
            
            // Botón para cerrar el sidebar
            if (closeSidebarButton) {
                closeSidebarButton.addEventListener('click', function() {
                    closeAllMenus();
                });
            }
            
            // Botón para cerrar el serverBar
            const closeServerBarButton = document.getElementById('closeServerBar');
            if (closeServerBarButton) {
                closeServerBarButton.addEventListener('click', function() {
                    closeAllMenus();
                });
            }
            
            // Cerrar menús al hacer clic en links dentro de ellos (en móvil)
            document.querySelectorAll('#serverBar a, #channelList a').forEach(link => {
                link.addEventListener('click', function() {
                    // Solo cerrar en vista móvil
                    if (window.innerWidth < 768) {
                        closeAllMenus();
                    }
                });
            });
            
            // Funciones para el overlay
            function addOverlay(overlayId = 'modal-overlay') {
                // Sólo añadir si no existe ya
                removeOverlay(); // Eliminar cualquier overlay existente primero
                
                const overlay = document.createElement('div');
                overlay.id = overlayId;
                overlay.className = 'fixed inset-0 bg-black bg-opacity-50 z-30';
                overlay.addEventListener('click', function() {
                    closeAllMenus();
                });
                document.body.appendChild(overlay);
            }
            
            function removeOverlay() {
                // Eliminar cualquier overlay existente
                const overlays = document.querySelectorAll('[id$="-overlay"]');
                overlays.forEach(overlay => {
                    overlay.remove();
                });
            }
            
            // Actualizar la función closeAllMenus para manejar correctamente los overlays
            function closeAllMenus() {
                // Cerrar sidebar
                if (channelList) {
                    channelList.classList.remove('translate-x-0');
                    channelList.classList.add('-translate-x-full');
                }
                
                // Cerrar server bar (solo en móvil, en desktop siempre visible)
                if (serverBar && window.innerWidth < 768) {
                    serverBar.classList.remove('translate-y-0');
                    serverBar.classList.add('translate-y-full');
                }
                
                // Quitar cualquier overlay
                removeOverlay();
            }
        });
    </script>
</body>
</html>
